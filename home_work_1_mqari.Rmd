---
title: "home_work_1_mqari"
author: "Mubashira Qari"
date: "2026-02-01"
output: html_document
---

```{r}
library(fpp3)
```
```{r}
global_economy
```

```{r}
tourism

```

```{r}
# Creating tsibble
mydata <- tsibble (
  year = 2015:2019,
  y = c(123,39,78,52,110),
  index =year
)
mydata
```


```{r}
# Creating tsibble
mydata <- tibble (
  year = 2015:2019,
  y = c(123,39,78,52,110)
) |>
  as_tsibble(index = year)
  
mydata
```


```{r}
library(tibble)

z <- tibble(
  Month = c("2019 Jan", "2019 Feb", "2019 Mar", "2019 Apr", "2019 May"),
  Observation = c(50, 23, 34, 30, 25)
)

z


```

```{r}
z |> 
  mutate(Month =yearmonth(Month)) |>
  as_tsibble(index = Month)
```
```{r}
prison <- readr::read_csv("C:/Users/Uzma/CUNY-SPS-Assignments/Data_624/Data_624_Predictive_Analytics/prison_population.csv")

prison
```
```{r}
library(readr)
library(dplyr)
library(tsibble)
library(lubridate)

prison <- read_csv(
  "C:/Users/Uzma/CUNY-SPS-Assignments/Data_624/Data_624_Predictive_Analytics/prison_population.csv"
) |>
  mutate(
    Date = as.Date(Date),          # ensure proper date
    Quarter = yearquarter(Date)
  ) |>
  as_tsibble(
    index = Quarter,
    key = c(State, Gender, Legal, Indigenous)
  )

prison

```
```{r}
PBS
```

```{r}
# Use filter function to select rows
PBS |>
  filter(ATC2 == "A10") |>
  select(Month, Concession,Type, Cost) |>
  summarise(TotalC = sum(Cost)) |>
  mutate(Cost =TotalC/1e6) -> a10

a10
```


```{r}
# Note it will pick the first variable it sees - hence select appropriate variable
a10 |> 
  autoplot(Cost) + labs(y="$(millions)",
                        title="Australian antidiabetic drug sales")
```
# Also note points/obs are joint by lines

```{r}
# This is not useful for me since we want to see the patterns
a10 |>
  ggplot(aes(x=Month, y=Cost)) +
  geom_point()

```
```{r}
# So we join the points with line so see the patterns
a10 |>
  ggplot(aes(x=Month, y=Cost)) +
  geom_line()
```

```{r}
a10 |> 
  autoplot(Cost)
```
```{r}
a10 |> 
  autoplot(Cost) + geom_point()
```

```{r}
a10 |> 
  autoplot(Cost) + geom_point() +
  labs(title = "Antidiabetics drug sales",
       y = "$ million")
```
```{r}
ansett
```



```{r}
ansett |>
  autoplot(Passengers)
```


```{r}
ansett |> distinct(Class)
# ansett |> distinct(Airports)
```
# 10 Airport * 3 Class = 30 unique time series

```{r}
ansett |> 
  filter(Class=="Economy") |>
  autoplot()
```
# Lets filter little more

```{r}
melsyd_economy <- ansett |>
  filter(Airports == "MEL-SYD") |>
  select(-Airports)

melsyd_economy
```

```{r}
melsyd_economy |>autoplot()
```


```{r}
melsyd_economy <- ansett |>
  filter(Airports == "MEL-SYD", Class == "Economy") |>
  mutate(Passengers = Passengers/1000)
autoplot(melsyd_economy, Passengers) +
  labs(title = "Ansett airlines economy class",
       subtitle = "Melbourne-Sydney",
       y = "Passengers ('000)")
```

# Time Series Patterns

```{r}
aus_production
```


```{r}
aus_production |>
  filter(year(Quarter) >= 1980) |>
  autoplot(Electricity) +
  labs(y = "GWh", title = "Australian electricity production")
```


```{r}
aus_production |>
  autoplot(Bricks) +
  labs(y = "millio units", title = "Australian clay brick production")
```
```{r}
us_employment
names(us_employment)
```


```{r}

us_employment |>
  filter(
   Title == "Retail Trade",
    year(Month) >= 1980) |>
  autoplot(Employed / 1e3) +
  labs(
    y = "Million people",
    title = "Retail employment, Australia"
  )
```
```{r}

gafa_stock %>%
  filter(Symbol == "AMZN", year(Date) == 2018) %>%
  autoplot(Close) +
  labs(y = "$US",
       title = "Amazon closing stock price")
```


```{r}

pelt|>
  autoplot(Lynx) +
  labs(y="Number trapped", title = "Annual Canadian Lynx Trappings")
```

```{r}
a10 |>
  gg_season(Cost, labels = "both") +
  labs(y = "$ (millions)",
       title = "Seasonal plot: Antidiabetic drug sales")
```

```{r}
library(fpp3)

# Filter for quarterly beer production from 1992 onwards
beer <- aus_production |>
  select(Quarter, Beer) |>
  filter(year(Quarter) >= 1992)

# Standard Time Plot
beer |>
  autoplot(Beer) +
  labs(title = "Australian quarterly beer production",
       y = "Megalitres")
```

```{r}
# Standard Time Plot
beer |>
  autoplot(Beer) + geom_point()
  labs(title = "Australian quarterly beer production",
       y = "Megalitres")
```

```{r}
beer |> gg_season(Beer, labels="right")
```
```{r}
vic_elec
```


```{r}
vic_elec |> gg_season(Demand)
```
```{r}
vic_elec |> autoplot()
```


```{r}
vic_elec |> gg_season(Demand, period = "week")
```

```{r}
vic_elec |> gg_season(Demand, period = "day")
```
```{r}
a10 |>
  gg_subseries(Cost) +
  labs(
    y = "$ (millions)",
    title = "Australian antidiabetic drug sales"
  )
```


```{r}
beer |> gg_subseries(Beer)

```


```{r}
holidays <- tourism |>
  filter(Purpose == "Holiday") |>
  group_by(State) |>
  summarise(Trips = sum(Trips))

holidays
```

```{r}
autoplot(holidays, Trips) +
  labs(y = "Overnight trips ('000)",
       title = "Australian domestic holidays")
```

```{r}
gg_season(holidays, Trips) +
  labs(y = "Overnight trips ('000)",
       title = "Australian domestic holidays")
```

```{r}
holidays |>
  gg_subseries(Trips) +
  labs(y = "Overnight trips ('000)",
       title = "Australian domestic holidays")
```
```{r}
holidays |> gg_subseries(Trips) +
  facet_wrap(vars(State), nrow=2, scales="free_y")+
  labs(y = "Thousands of trips", title = "Australian domestic holidays night")
```
```{r}
vic_elec
```



```{r}
vic_elec |>
  filter(year(Time) == 2014) |>
  autoplot(Demand) +
  labs(y = "GW",
       title = "Half-hourly electricity demand: Victoria")
```
ðŸ”¹ Step 1: Load the package
library(fpp3)

What this does:

Loads the fpp3 package.

fpp3 stands for Forecasting: Principles and Practice (3rd edition).

It includes tools for:

Time series analysis

Forecasting models

Data manipulation (via tidyverse packages like dplyr)

It also contains the dataset vic_elec, which is what you're using.

ðŸ”¹ Step 2: Start with the dataset
vic_elec_day_type <- vic_elec |>

Whatâ€™s happening:

vic_elec is a built-in dataset in fpp3.

It contains electricity demand data for Victoria, Australia.

Youâ€™re creating a new object called:

vic_elec_day_type


So you're saying:

â€œTake vic_elec, transform it, and store the result in vic_elec_day_type.â€

ðŸ”¹ Step 3: The Pipe Operator |>

This symbol:

|>


is called the pipe operator.

What it means:

â€œTake the result from the left, and pass it into the function on the right.â€

Instead of writing:

filter(vic_elec, year(Time) == 2014)


You write:

vic_elec |> filter(year(Time) == 2014)


It reads like English:

Take vic_elec, then filter it.

Much cleaner and easier to read.

ðŸ”¹ Step 4: Filter only 2014
filter(year(Time) == 2014)

What this does:

filter() keeps only rows that match a condition.

year(Time) extracts the year from the Time column.

== 2014 keeps only data from 2014.

So:

Keep only rows where the year is 2014.

Now your dataset contains only 2014 electricity data.

ðŸ”¹ Step 5: Create a new column with mutate()
mutate(
  Day_Type = case_when(

What is mutate()?

mutate() creates new columns or modifies existing ones.

Here you're creating a new column called:

Day_Type

ðŸ”¹ Step 6: Understanding case_when()

This is very important to understand.

case_when() works like an if-else ladder.

Basic structure:

case_when(
  condition1 ~ "result1",
  condition2 ~ "result2",
  TRUE ~ "default"
)


It checks conditions in order, and uses the first one that is TRUE.

ðŸ”¹ Step 7: First condition â€” Holiday
Holiday ~ "Holiday"


If the Holiday column is TRUE:

âž¡ assign "Holiday" to Day_Type

So all public holidays are labeled "Holiday".

ðŸ”¹ Step 8: Second condition â€” Weekday
wday(Date) %in% 2:6 ~ "Weekday"


Letâ€™s break this apart:

ðŸ”¹ wday(Date)

wday() extracts the day of the week

Returns numbers:

1 = Sunday

2 = Monday

3 = Tuesday

4 = Wednesday

5 = Thursday

6 = Friday

7 = Saturday

ðŸ”¹ %in% 2:6

2:6 means numbers 2,3,4,5,6

%in% checks if the value is in that list

So this means:

If the day is Mondayâ€“Friday â†’ label it "Weekday"

âš ï¸ Note: The comment in your code says:

# If it is Sunday (1) or Saturday (7)


But that comment is incorrect.

2:6 is Monday to Friday â€” not Sunday or Saturday.

ðŸ”¹ Step 9: Default condition
TRUE ~ "Weekend"


If none of the above conditions were true:

âž¡ It must be Saturday or Sunday
âž¡ So label it "Weekend"

Why use TRUE?

Because TRUE will always match â€” it's the fallback.

ðŸ”¹ Step 10: Final Result
vic_elec_day_type


This just prints the new dataset so you can see the result.

ðŸ”¹ What the Final Dataset Contains

Now vic_elec_day_type:

Only contains data from 2014

Has a new column called Day_Type

Each row is labeled as:

"Holiday"

"Weekday"

"Weekend"

ðŸ”¹ Full Logic in Plain English

Load electricity data.

Keep only year 2014.

Add a new column called Day_Type.

If it's a holiday â†’ label it Holiday.

Else if it's Mondayâ€“Friday â†’ label it Weekday.

Otherwise â†’ label it Weekend.

Print the dataset.

ðŸ”¹ How You Could Write This From Scratch

Hereâ€™s a simplified mental template you can reuse:

data |> 
  filter(condition) |> 
  mutate(
    new_column = case_when(
      condition1 ~ "label1",
      condition2 ~ "label2",
      TRUE ~ "default_label"
    )
  )
  
  ðŸ”¹ Small Improvement Suggestion

To avoid confusion, you could rewrite the comments like this:

wday(Date) %in% 2:6 ~ "Weekday", # Monday to Friday
TRUE ~ "Weekend"                 # Saturday or Sunday

ðŸ”¹ Practice Exercise (So You Learn to Write It Yourself)

Try modifying it to:

Create "Monday" as its own category

Everything else as "Other"

Hint:

mutate(
  Day_Type = case_when(
    wday(Date) == 2 ~ "Monday",
    TRUE ~ "Other"
  )
)


```{r}
library(fpp3)

vic_elec_day_type <- vic_elec |>
  filter(year(Time) == 2014) |>
  mutate(
    # Create a new column 'Day_Type' to categorize days
    Day_Type = case_when(
      Holiday ~ "Holiday",             # If it is a Public Holiday
      wday(Date) %in% 2:6 ~ "Weekday", # If it is Sunday (1) or Saturday (7)
      TRUE ~ "Weekend"                 # Otherwise, it is a Workday
    ))
vic_elec_day_type
```
```{r}
vic_elec |>
  filter(year(Time) == 2014) |>
  autoplot(Temperature) +
  labs(
    y = "Degrees Celsius",
    title = "Half-hourly temperatures: Melbourne, Australia"
  )
```


```{r}
vic_elec |>
  filter(year(Time) == 2014) |>
  ggplot(aes(x = Temperature, y = Demand)) +
  geom_point() +
  labs(title="Electricity demand versus Temperature",
       x = "Temperature (degrees Celsius)",
       y = "Electricity demand (GW)")
```


```{r}
vic_elec_day_type |>
  filter(year(Time) == 2014) |>
  ggplot(aes(x = Temperature, y = Demand, colour=Day_Type)) +
  geom_point() +
  labs(title="Electricity demand versus Temperature",
       x = "Temperature (degrees Celsius)",
       y = "Electricity demand (GW)")
```
```{r}
library(fpp3)

us_change

```


```{r}
visitors <- tourism |>
  group_by(State) |>
  summarise(Trips = sum(Trips))
visitors |>
  ggplot(aes(x = Quarter, y = Trips)) +
  geom_line() +
  facet_grid(vars(State), scales = "free_y") +
  labs(title = "Australian domestic tourism",
       y= "Overnight trips ('000)")
```


```{r}
visitors |>
  pivot_wider(values_from=Trips, names_from=State) |>
  GGally::ggpairs(columns = 2:9)
```


```{r}
recent_production |> gg_lag(Beer, geom ="point")
```

```{r}
recent_production |> gg_lag(Beer)
```


```{r}
recent_production <- aus_production |>
  filter(year(Quarter) >= 2000)
recent_production |>
  gg_lag(Beer, geom = "point") +
  labs(x = "lag(Beer, k)")
```

```{r}
recent_production |> ACF(Beer, lag_max =9)
```


```{r}

recent_production |> ACF(Beer, lag_max =9) |> autoplot()
```


```{r}
recent_production |> ACF(Beer, lag_max = 9)
#> # A tsibble: 9 x 2 [1Q]
#>        lag      acf
#>   <cf_lag>    <dbl>
#> 1       1Q -0.0530 
#> 2       2Q -0.758  
#> 3       3Q -0.0262 
#> 4       4Q  0.802  
#> 5       5Q -0.0775 
#> 6       6Q -0.657  
#> 7       7Q  0.00119
#> 8       8Q  0.707  
#> 9       9Q -0.0888
```
```{r}
recent_production |>
  ACF(Beer) |>
  autoplot() + labs(title="Australian beer production")
```

```{r}
a10 |>
  ACF(Cost, lag_max = 48) |>
  autoplot() +
  labs(title="Australian antidiabetic drug sales")
```
```{r}
library(fpp3)

# Create the google_2015 object
google_2015 <- gafa_stock |>
  filter(Symbol == "GOOG", year(Date) == 2015) |>
  select(Date, Close)
google_2015
```


```{r}
# Plot the closing price
google_2015 %>%
  autoplot(Close) +
  labs(y = "$US",
       title = "Google closing stock price (2015)")
```
```{r}
# Create the ACF Plot
google_2015 %>%
  ACF(Close, lag_max = 50)|>
  autoplot() +
  labs(title = "Google closing stock price (2015)")
```
```{r}
set.seed(30)
y <- tsibble(sample = 1:50, wn = rnorm(50), index = sample)
y |> autoplot(wn) + labs(title = "White noise", y = "")
```

```{r}
y |>
  ACF(wn) |>
  autoplot() + labs(title = "White noise")
```
```{r}
# Filter for Pig slaughter in Victoria (2014-2019)
pigs <- aus_livestock %>%
  filter(State == "Victoria", Animal == "Pigs", year(Month) >= 2014)

pigs
```


```{r}
# Plot the time series to see the monthly fluctuations
pigs |>
  autoplot(Count) +
  labs(y = "Count",
       title = "Number of pigs slaughtered in Victoria")
```

```{r}
# Plot the ACF
pigs |>
  ACF(Count) |>
  autoplot() +
  labs(title = "ACF of pigs slaughtered in Victoria")
```

